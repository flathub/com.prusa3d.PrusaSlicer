From bd071f99a1ac9c513befa74fd68466ddda415678 Mon Sep 17 00:00:00 2001
From: Elia Devito <eliadevito@gmail.com>
Date: Tue, 21 Feb 2023 15:32:30 +0100
Subject: [PATCH] enable wayland

---
 src/PrusaSlicer.cpp | 18 +++++++++---------
 1 file changed, 9 insertions(+), 9 deletions(-)

diff --git a/src/PrusaSlicer.cpp b/src/PrusaSlicer.cpp
index c5bbccb24..d473872e4 100644
--- a/src/PrusaSlicer.cpp
+++ b/src/PrusaSlicer.cpp
@@ -75,12 +75,12 @@ int CLI::run(int argc, char **argv)
     // Save the thread ID of the main thread.
     save_main_thread_id();
 
-#ifdef __WXGTK__
-    // On Linux, wxGTK has no support for Wayland, and the app crashes on
-    // startup if gtk3 is used. This env var has to be set explicitly to
-    // instruct the window manager to fall back to X server mode.
-    ::setenv("GDK_BACKEND", "x11", /* replace */ true);
-#endif
+// #ifdef __WXGTK__
+//     // On Linux, wxGTK has no support for Wayland, and the app crashes on
+//     // startup if gtk3 is used. This env var has to be set explicitly to
+//     // instruct the window manager to fall back to X server mode.
+//     ::setenv("GDK_BACKEND", "x11", /* replace */ true);
+// #endif
 
 	// Switch boost::filesystem to utf8.
     try {
@@ -659,9 +659,9 @@ int CLI::run(int argc, char **argv)
     #if !defined(_WIN32) && !defined(__APPLE__)
         // likely some linux / unix system
         const char *display = boost::nowide::getenv("DISPLAY");
-        // const char *wayland_display = boost::nowide::getenv("WAYLAND_DISPLAY");
-        //if (! ((display && *display) || (wayland_display && *wayland_display))) {
-        if (! (display && *display)) {
+        const char *wayland_display = boost::nowide::getenv("WAYLAND_DISPLAY");
+        // if (! (display && *display)) {
+        if (! ((display && *display) || (wayland_display && *wayland_display))) {
             // DISPLAY not set.
             boost::nowide::cerr << "DISPLAY not set, GUI mode not available." << std::endl << std::endl;
             this->print_help(false);
-- 
2.39.2

