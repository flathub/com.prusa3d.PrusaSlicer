From 305586f68dd2654a95ae83e69dd91261bdd63d79 Mon Sep 17 00:00:00 2001
From: Elia Devito <eliadevito@gmail.com>
Date: Wed, 30 Aug 2023 18:53:17 +0200
Subject: [PATCH] add support for flatpak in
 perform_downloader_desktop_integration

---
 src/slic3r/GUI/DesktopIntegrationDialog.cpp | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/src/slic3r/GUI/DesktopIntegrationDialog.cpp b/src/slic3r/GUI/DesktopIntegrationDialog.cpp
index 62e841153..e67a75f2b 100644
--- a/src/slic3r/GUI/DesktopIntegrationDialog.cpp
+++ b/src/slic3r/GUI/DesktopIntegrationDialog.cpp
@@ -462,6 +462,7 @@ void DesktopIntegrationDialog::perform_downloader_desktop_integration()
     BOOST_LOG_TRIVIAL(debug) << "performing downloader desktop integration.";
     // Path to appimage
     const char* appimage_env = std::getenv("APPIMAGE");
+    const char* container_env = std::getenv("container");
     std::string excutable_path;
     if (appimage_env) {
         try {
@@ -473,6 +474,10 @@ void DesktopIntegrationDialog::perform_downloader_desktop_integration()
             return;
         }
     }
+    else if (strcmp(container_env, "flatpak") == 0) {
+        const char* flatpak_id = std::getenv("FLATPAK_ID");
+        excutable_path = "flatpak run " + std::string(flatpak_id);
+    }
     else {
         // not appimage - find executable
         excutable_path = boost::dll::program_location().string();
-- 
2.41.0

