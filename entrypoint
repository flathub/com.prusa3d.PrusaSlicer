#!/usr/bin/env sh

args=("$@")

if [ "$PRUSA_SLICER_DARK_THEME" == "true" ]; then
	echo "PRUSA_SLICER_DARK_THEME enabled"
	GTK_THEME="Adwaita:dark" /app/bin/prusa-slicer $args > /dev/null 2>&1 < /dev/null &
	wait $!
	EXIT_CODE=$?
	if [ $EXIT_CODE -ne 0 ]; then 
		echo "there was a locale issue, will force LC_ALL=en_US.UTF-8"
		LC_ALL=en_US.UTF-8 GTK_THEME="Adwaita:dark" /app/bin/prusa-slicer $args > /dev/null 2>&1 < /dev/null &
	fi
	/app/bin/set-dark-theme-variant.py > /dev/null 2>&1 < /dev/null &
else
	echo "PRUSA_SLICER_DARK_THEME disabled"
	/app/bin/prusa-slicer $args > /dev/null 2>&1 < /dev/null &
	wait $!
	EXIT_CODE=$?
	if [ $EXIT_CODE -ne 0 ]; then
		echo "there was a locale issue, will force LC_ALL=en_US.UTF-8"
		LC_ALL=en_US.UTF-8 /app/bin/prusa-slicer $args > /dev/null 2>&1 < /dev/null &
	fi
fi

exit $EXIT_CODE
